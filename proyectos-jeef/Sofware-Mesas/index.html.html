
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gesti√≥n Mesas - Modal</title>
  <link href="styles.css" rel="stylesheet" >
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
   
  </style>
</head>



<body>

  <!-- Bot√≥n para abrir modal -->
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalMesas">
    Agregar mesa
  </button>

  <!-- Modal -->
  <div class="modal fade" id="modalMesas" tabindex="-1" aria-labelledby="modalMesasLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalMesasLabel">Agregar mesa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <input type="number" id="modal-numero" class="form-control mb-2" placeholder="N√∫mero de mesa" required>
          <input type="number" id="modal-cantidad" class="form-control mb-2" placeholder="Cantidad de personas">
          <input type="text" id="modal-ubicacion" class="form-control mb-2" placeholder="Ubicaci√≥n">
          <select id="modal-estado" class="form-select mb-2">
            <option value="Libre">Libre</option>
            <option value="Deshabilitada">Deshabilitada</option>
  <option value="Ocupada">Ocupada</option>
          </select>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="btnGuardarModal">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla -->

    <div id="bodyData"></div>
  
   <!-- Bot√≥n para mostrar formulario -->
<div class="p-4 bg-light">

  <button id="btnReserva" class="btn btn-success mb-3" onclick="mostrarFormularioNew()">‚ûï Hacer Reserva</button>

  <!-- Formulario (oculto al inicio) -->
  <div id="formulario" style="display: none; flex-direction: column; gap: 15px; padding: 20px; 
    background: white; border-radius: 10px; box-shadow: 2px 2px 6px gray; max-width: 400px;">
    
    <h3>Registro de Reserva</h3>
    <input type="number" id="idreserva" class="form-control" placeholder="ID √∫nico de la mesa" required>
    <input type="number" id="modal-numero" class="form-control" placeholder="N√∫mero de mesa" required>
    <input type="text" id="nombreCleinte" class="form-control" placeholder="Nombre del cliente" required>
<small id="errorNombre" style="color:red; display:none;"></small>

    <input type="number" id="NumReservas" class="form-control" placeholder="N√∫mero de personas" required>
 <small id="errorNombre1" style="color:red; display:none;"></small>   

<input type="date" id="Datereserva" class="form-control" placeholder="Fecha de reserva">
<small id="errorNombre2" style="color:red; display:none;"></small>

    <select id="ocasiones-especiales" class="form-select">
      <option value="cumplea√±os">Cumplea√±os</option>
      <option value="Aniversario">Aniversario</option>
      <option value="Reunion de Negocios">Reuni√≥n de Negocios</option>
      <option value="Boda">Boda</option>
      <option value="Despedida">Despedida</option>
      <option value="Graduacion">Graduaci√≥n</option>
      <option value="Compromiso">Compromiso</option>
      <option value="Dia de la Madre">D√≠a de la Madre</option>
      <option value="Dia del Padre">D√≠a del Padre</option>
      <option value="San Valentin">San Valent√≠n</option>
      <option value="Navidad">Navidad</option>
      <option value="A√±o Nuevo">A√±o Nuevo</option>
    </select>

    <input type="text" id="Notas" class="form-control" placeholder="Notas para la atenci√≥n">

    <select id="estado" class="form-select">
      <option value="Pendiente">Pendiente</option>
      <option value="Confirmada">Confirmada</option>
      <option value="Cancelada">Cancelada</option>
      <option value="Finalizada">Finalizada</option>
    </select>
<select id="select-mesa" class="form-select mb-2" required>
  <option value="">Seleccione una mesa</option>
</select>

    <div class="d-flex gap-2">

      <button id="save" onclick="guardarNew()" class="btn btn-primary w-50">Guardar</button>
      <button type="button" class="btn btn-secondary w-50" onclick="ocultarFormularioNew()">Cancelar</button>
    </div>
  </div>

  <!-- Tabla de reservas -->
  <div class="mt-4">
    <table class="table table-dark table-striped">
      <thead>
        <tr>
          <th>ID</th>
          <th>Mesa</th>
          <th>Cliente</th>
          <th>Personas</th>
          <th>Fecha</th>
          <th>Ocasi√≥n</th>
          <th>Notas</th>
          <th>Estado</th>
          <th>Opciones</th>


        </tr>
      </thead>
      <tbody id="infoData"></tbody>
    </table>
  </div>

</div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Inicializar localStorage
    if (!localStorage.getItem("mesas")) {
      localStorage.setItem("mesas", JSON.stringify([]));
    }

    let mesas = JSON.parse(localStorage.getItem("mesas"));
    let editIndex = null;
function obtenerSiguienteNumeroMesa() {
  // Si no hay mesas, empezamos desde 1
  if (mesas.length === 0) return 1;

  // Obtener el n√∫mero m√°ximo de las mesas existentes
  const max = Math.max(...mesas.map(m => Number(m.numero)));
max.setAttribute("readonly", true);
  // Guardar el m√°ximo en localStorage para llevar el control
  localStorage.setItem("ultimoNumeroMesa", max);

  // Devolver el siguiente n√∫mero disponible
  return max + 1;
}


const guardarDesdeModal = () => {

  const numero = document.getElementById("modal-numero").textContent=obtenerSiguienteNumeroMesa();
 document.getElementById("modal-numero").setAttribute("readonly", true);
  const cantidad = document.getElementById("modal-cantidad").value;
  const ubicacion = document.getElementById("modal-ubicacion").value;
  const estado = document.getElementById("modal-estado").value;

document.querySelector('[data-bs-target="#modalMesas"]').addEventListener("click", () => {
  editIndex = null;
  document.getElementById("modalMesasLabel").textContent = "Agregar mesa";
document.getElementById("modal-numero").textContent=obtenerSiguienteNumeroMesa();
 document.getElementById("modal-numero").setAttribute("readonly", true);
  document.getElementById("modal-cantidad").value = "";
  document.getElementById("modal-ubicacion").value = "";
  document.getElementById("modal-estado").value = "Libre";
});

  if (!numero || !cantidad || !ubicacion) {
    alert("Complete todos los campos");
    return;
  }

  if (editIndex === null) {
    // üëâ Cuando se crea una mesa nueva
    const reg = { numero, cantidad, ubicacion, estado };
    mesas.push(reg);
  } else {
    // üëâ Cuando se edita, solo actualiza los campos editables
    mesas[editIndex].cantidad = cantidad;
    mesas[editIndex].ubicacion = ubicacion;
    mesas[editIndex].estado = estado;
    editIndex = null;
    document.getElementById("modalMesasLabel").textContent = "Agregar mesa";
  }

  localStorage.setItem("mesas", JSON.stringify(mesas));
obtenerSiguienteNumeroMesa();
  pintarDatos();

  bootstrap.Modal.getInstance(document.getElementById("modalMesas")).hide();
};


 function actualizarSelectMesas() {
    const selectMesa = document.getElementById("select-mesa");
    selectMesa.innerHTML = '<option value="">Seleccione una mesa</option>';

    mesas.forEach((mesa) => {
      if (mesa.estado === "Libre") {
        const option = document.createElement("option");
        option.value = mesa.numero;
        option.textContent = `Mesa ${mesa.numero} - (${mesa.cantidad} personas)`;
        selectMesa.appendChild(option);
      }
    });

    selectMesa.addEventListener("change", () => {
      const estadoInput = document.getElementById("modal-estado");
      estadoInput.value = selectMesa.value !== "" ? "Ocupada" : "";
    });
  }

  // üëâ este bloque escucha cuando abras el modal
  const modalMesas = document.getElementById("modalMesas");
  modalMesas.addEventListener("shown.bs.modal", () => {
    console.log("Modal abierto, actualizando select...");
    actualizarSelectMesas();
  });


// function actualizarSelectMesas() {
//   const selectMesa = document.getElementById("select-mesa");
//   selectMesa.innerHTML = '<option value="">Seleccione una mesa</option>';

//   mesas.forEach((mesa, i) => {
//     if (mesa.estado === "Libre") { // üëâ solo mostrar mesas disponibles
//       const option = document.createElement("option");
//       option.value = mesa.numero;
//       option.textContent = `Mesa ${mesa.numero} - (${mesa.cantidad} personas)`;
//       selectMesa.appendChild(option);
//     }
// if(option===true){
// document.getElementById(modal-estado).estado.value==="ocupada"
// }else{
// console.log("error datos")
// }
//   });
// }

  const pintarDatos = () => {
  const body = document.getElementById("bodyData");
  body.innerHTML = ""; // limpiar contenedor

  mesas.forEach((item, i) => {
    const tr = document.createElement("div");

    // Estilos de la "carta" de la mesa
    tr.style.backgroundColor = "lightblue";
    tr.style.padding = "10px";
    tr.style.border = "1px solid #333";
    tr.style.margin = "8px 0";
    tr.style.display = "flex";
    tr.style.flexDirection = "column";
    tr.style.width = "600px";
    tr.style.height = "450px";

    // Bot√≥n de reservar din√°mico seg√∫n el estado
    const botonReservar = item.estado === "Deshabilitada" 
        ? "" 
        : `<button class="btn btn-sm btn-success me-1" onclick="reservarMesa(${i})">üìå Reservar</button>`;

    // HTML de la mesa
    tr.innerHTML = `
      <div class="card1">
        <h2 class="texto">N√∫mero: ${item.numero}</h2>
        <h2 class="texto">Cantidad: ${item.cantidad}</h2>
        <h2 class="texto">Ubicaci√≥n: ${item.ubicacion}</h2>
        <h2 class="texto">Estado: ${item.estado}</h2>
        <div class="botones">
          <button class="btn btn-sm btn-warning me-1" onclick="editarMesa(${i})">üìù</button>
          <button class="btn btn-sm btn-danger" onclick="eliminarMesa(${i})">‚ùå</button>
          ${botonReservar} <!-- ‚úÖ Inserta el bot√≥n din√°mico -->
        </div>
      </div>
    `;

    body.appendChild(tr);
  });

  // Actualizar select de mesas libres
   actualizarSelectMesas();
};


function reservarMesa(i) {
  // Cambiar estado a Ocupada
  mesas[i].estado = "Ocupada";
  localStorage.setItem("mesas", JSON.stringify(mesas));
  pintarDatos();

  // Pasar n√∫mero de mesa al formulario de reserva
  document.getElementById("reserva-numero").value = mesas[i].numero;
  
  // Mostrar formulario de reserva
  mostrarFormularioNew();
}


// function reservarMesa(i) {
//   // Cambiar estado a Ocupada
//   mesas[i].estado = "Ocupada";

//   // Guardar en localStorage
//   localStorage.setItem("mesas", JSON.stringify(mesas));

//   // Refrescar vista
//   pintarDatos();

//   // üëâ Mostrar modal de reserva (si lo tienes)
//   // ejemplo con Bootstrap:
//   const modalReserva = new bootstrap.Modal(document.getElementById("modalReserva"));
//   modalReserva.show();

//   // Si necesitas pasar el n√∫mero de mesa al modal
//   document.getElementById("idreserva").value = mesas[i].numero;
// }



  function obtenerSiguienteNumeroMesa() {
  if (mesas.length === 0) return 1; // Si no hay mesas, empezamos desde 1

  const max = Math.max(...mesas.map(m => Number(m.numero)));

  // Si max es menor o igual a 0, empezamos desde 1
  return max > 0 ? max + 1 : 1;
}



    document.getElementById("btnGuardarModal").addEventListener("click", guardarDesdeModal);

    window.editarMesa = (i) => {
      const mesa = mesas[i];
//CODIGO PARA NO PODER EDITAR NUMERO DE MESA

  // ‚úÖ Bloquear el n√∫mero de mesa en el objeto

      editIndex = i;
document.getElementById("modal-numero").setAttribute("readonly", true);
      document.getElementById("modal-cantidad").value = mesa.cantidad;
      document.getElementById("modal-ubicacion").value = mesa.ubicacion;
      document.getElementById("modal-estado").value = mesa.estado;
      document.getElementById("modalMesasLabel").textContent = "Editar mesa";
      new bootstrap.Modal(document.getElementById("modalMesas")).show();

    };

    window.eliminarMesa = (i) => {
      if (confirm("¬øEliminar esta mesa?")) {
        mesas.splice(i, 1);
        localStorage.setItem("mesas", JSON.stringify(mesas));
        pintarDatos();

      }
    };

    document.addEventListener("DOMContentLoaded", pintarDatos);
  </script>


<script>
  let datos = [];

  // ‚úÖ Cargar datos desde LocalStorage al iniciar
  window.onload = function () {
    let reservasGuardadas = localStorage.getItem("reservas");
    if (reservasGuardadas) {
      datos = JSON.parse(reservasGuardadas);
      pintarDatosNew();
    }
  };

  function guardarLocalStorage() {
    localStorage.setItem("reservas", JSON.stringify(datos));
  }

  function mostrarFormularioNew() {
    document.getElementById("formulario").style.display = "flex";
    document.getElementById("btnReserva").style.display = "none";
  }

  function ocultarFormularioNew() {
    document.getElementById("formulario").style.display = "none";
    document.getElementById("btnReserva").style.display = "inline-block";
    limpiarFormularioNew();
  }

  // function cambiarColorDiv(idElemento, color) {
  //       const elemento = document.getElementById(idElemento);
  //       if (elemento) { // Verifica si el elemento existe
  //           elemento.style.backgroundColor = color; // Cambia el color de fondo
  //       } else {
  //           console.error("Elemento no encontrado con el ID:", idElemento); // Opcional: muestra un error en la consola si el elemento no existe
  //       }
  //   }



function fechaActual() {
  const hoy = new Date();
  const a√±o = hoy.getFullYear();
  const mes = String(hoy.getMonth() + 1).padStart(2, "0"); 
  const dia = String(hoy.getDate()).padStart(2, "0");
  return `${a√±o}-${mes}-${dia}`; // Ej: 2025-08-31
}

// }else if( document.getElementById("NumReservas").value <= 0 ){
// alert("Por favor digite un numero mayor a 0 ")
// return;
// }else if(document.getElementById("Datereserva").value <= fechaActual()){
// alert("Por favor ingrese uan fecha correcta, no pasada ")
// return;
// }else if(document.getElementById("select-mesa").value == ""){
// alert("Por favor selecfcione una mesa para la reserva ")
// return;}



function pagarCuenta(i) {
  let item = datos[i];

  // Por ejemplo, cambiar el estado a ‚ÄúPagada‚Äù
  item.estado = "Finalizado";
item.modalnumero = "disponible";
  // Guardar cambios en localStorage
  localStorage.setItem("reservas", JSON.stringify(datos));

  // Refrescar la tabla
  pintarDatosNew();

  alert(`La cuenta de ${item.cliente} (Mesa ${item.mesa}) ha sido pagada ‚úÖ`);
}

function limpiarFormularioNew() {
  document.getElementById("modal-numero").value = "";
  document.getElementById("modal-cantidad").value = "";
  document.getElementById("modal-ubicacion").value = "";
  document.getElementById("modal-estado").value = "Libre"; // o en blanco ""
}




  function pintarDatosNew() {
    document.getElementById("infoData").innerHTML = ""; // limpiar tabla antes de pintar
    datos.forEach((item, i) => {
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.id}</td>
        <td>${item.mesa}</td>
        <td>${item.cliente}</td>
        <td>${item.personas}</td>
        <td>${item.fecha}</td>
        <td>${item.ocasion}</td>
        <td>${item.notas}</td>
        <td>${item.estado}</td>
        <td>
          <button class="btn btn-warning btn-sm" onclick="editarReservaNew(${i})">‚úèÔ∏è Editar</button>
          <button class="btn btn-danger btn-sm" onclick="eliminarReservaNew(${i})">üóëÔ∏è Eliminar</button>
<button class="btn btn-success btn-sm" onclick="pagarCuenta(${i})">üíµ Pagar Cuenta</button>
        </td>
      `;
      document.getElementById("infoData").appendChild(tr);
    });
  }


  function guardarNew() {
 if (document.getElementById("save").textContent == "Guardar"){
let elemento =  document.getElementById("nombreCleinte");
    const error = document.getElementById("errorNombre");
        if (elemento.value=="") { // Verifica si el elemento existe
            elemento.style.borderColor= "red"; // Cambia el color de fondo
  error.textContent = "‚ö†Ô∏è El nombre es obligatorio";
      error.style.display = "block"; // Muestra el mensaje
      return; // üî¥ Detiene la funci√≥n
    } else {
            console.error("Elemento no existe "); // Opcional: muestra un error en la consola si el elemento no existe
        }

 if (document.getElementById("save").textContent == "Guardar"){
 elemento =  document.getElementById("NumReservas");
const error1 = document.getElementById("errorNombre1");
        if (elemento.value=="") { // Verifica si el elemento existe
            elemento.style.borderColor= "red"; // Cambia el color de fondo
  error1.textContent = "‚ö†Ô∏è El Numero de Personas es obligatorio";
      error1.style.display = "block"; // Muestra el mensaje
      return; // üî¥ Detiene la funci√≥n
    } else {
            console.error("Elemento no existe "); // Opcional: muestra un error en la consola si el elemento no existe
        }


if (document.getElementById("save").textContent == "Guardar"){
 elemento =  document.getElementById("Datereserva");
const error2 = document.getElementById("errorNombre2");
        if (elemento.value=="") { // Verifica si el elemento existe
            elemento.style.borderColor= "red"; // Cambia el color de fondo
  error2.textContent = "‚ö†Ô∏è la fecha es de caracter obligatorio";
      error2.style.display = "block"; // Muestra el mensaje
      return; // üî¥ Detiene la funci√≥n
    } else {
            console.error("Elemento no existe "); // Opcional: muestra un error en la consola si el elemento no existe
        }
}
}
}


    let reg = {
      id: document.getElementById("idreserva").value,
 mesa: document.getElementById("select-mesa").value, // üëâ mesa elegida
      mesa: document.getElementById("modal-numero").value,
      cliente: document.getElementById("nombreCleinte").value,
      personas: document.getElementById("NumReservas").value,
      fecha: document.getElementById("Datereserva").value,
      ocasion: document.getElementById("ocasiones-especiales").value,
      notas: document.getElementById("Notas").value,
      estado: document.getElementById("estado").value,
  select: document.getElementById("select-mesa").value

    };
    datos.push(reg);

    guardarLocalStorage(); // ‚úÖ guardar en localStorage

    document.getElementById("infoData").innerHTML = "";
actualizarSelectMesas();
    pintarDatosNew();
    ocultarFormularioNew();

  }

  function editarReservaNew(i) {

    let item = datos[i];
    document.getElementById("idreserva").value = item.id;
    document.getElementById("modal-numero").value = item.mesa;
    document.getElementById("nombreCleinte").value = item.cliente;
    document.getElementById("NumReservas").value = item.personas;
    document.getElementById("Datereserva").value = item.fecha;
    document.getElementById("ocasiones-especiales").value = item.ocasion;
    document.getElementById("Notas").value = item.notas;
    document.getElementById("estado").value = item.estado;

    // Mostrar formulario para editar
    document.getElementById("formulario").style.display = "flex";
    document.getElementById("btnReserva").style.display = "none";

    // Eliminar temporalmente el registro para volverlo a guardar editado
    datos.splice(i, 1);
    guardarLocalStorage(); // ‚úÖ actualizar localStorage
    pintarDatosNew();
  }

  function eliminarReservaNew(i) {
    if (confirm("¬øSeguro que quieres eliminar esta reserva?")) {
      datos.splice(i, 1); // eliminar del array
      guardarLocalStorage(); // ‚úÖ actualizar localStorage
      pintarDatosNew(); // volver a pintar la tabla
    }
  }
</script>

</body>
</html>

</body>
</html>

  <style>
     .texto {
      color: teal;
      font-size: 4rem;
    }
    .btn btn-primary{
        font-size: 4rem;
    }
.botones{
    display: flex;
}
  .btn.btn-sm.btn-warning.me-1 {
  width: 8vw !important;
  height: 2vh !important;
}
.btn.btn-sm.btn-danger{
    width: 8vw !important;
  height: 2vh !important
}

  </style>
</body>
</html>